---
sidebar: sidebar 
permalink: openshift/os-rosa-app-workflows.html 
keywords: OpenShift, OCP, Trident, NetApp ONTAP, Red Hat OpenShift Service on AWS, 
summary: Servicio Red Hat OpenShift en AWS con NetApp ONTAP 
---
= Servicio Red Hat OpenShift en AWS con NetApp ONTAP
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Este documento describirá cómo utilizar NetApp ONTAP con Red Hat OpenShift Service en AWS (ROSA).



== Crear instantánea de volumen

**1.  Crear una instantánea del volumen de la aplicación** En esta sección, mostraremos cómo crear una instantánea de Trident del volumen asociado con la aplicación. Esta será una copia de un punto en el tiempo de los datos de la aplicación.  Si se pierden los datos de la aplicación, podemos recuperarlos desde esta copia del momento.  NOTA: Esta instantánea se almacena en el mismo agregado que el volumen original en ONTAP(en las instalaciones o en la nube).  Entonces, si se pierde el agregado de almacenamiento de ONTAP , no podemos recuperar los datos de la aplicación desde su instantánea.

**a.  Crear una VolumeSnapshotClass Guarde el siguiente manifiesto en un archivo llamado volume-snapshot-class.yaml

[source]
----
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshotClass
metadata:
 name: fsx-snapclass
driver: csi.trident.netapp.io
deletionPolicy: Delete
----
Cree una instantánea utilizando el manifiesto anterior.

image:redhat-openshift-container-rosa-020.png["clase de instantánea"]

**b.  A continuación, cree una instantánea** Cree una instantánea de la PVC existente creando VolumeSnapshot para tomar una copia de un punto en el tiempo de sus datos de Postgresql.  Esto crea una instantánea de FSx que casi no ocupa espacio en el backend del sistema de archivos.  Guarde el siguiente manifiesto en un archivo llamado volume-snapshot.yaml:

[source]
----
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshot
metadata:
 name: postgresql-volume-snap-01
spec:
 volumeSnapshotClassName: fsx-snapclass
 source:
   persistentVolumeClaimName: data-postgresql-0
----
**do.  Cree la instantánea del volumen y confirme que se ha creado**

Eliminar la base de datos para simular la pérdida de datos (la pérdida de datos puede ocurrir debido a una variedad de razones, aquí solo la estamos simulando eliminando la base de datos)

image:redhat-openshift-container-rosa-021.png["instantánea de volumen"]

**d.  Eliminar la base de datos para simular la pérdida de datos (la pérdida de datos puede ocurrir debido a una variedad de razones, aquí solo la estamos simulando eliminando la base de datos)**

image:redhat-openshift-container-rosa-022.png["conexión a la base de datos"]

image:redhat-openshift-container-rosa-023.png["eliminar base de datos"]



== Restaurar desde una instantánea de volumen

**1.  Restaurar desde una instantánea** En esta sección, mostraremos cómo restaurar una aplicación desde la instantánea trident del volumen de la aplicación.

**a.  Crear un clon de volumen a partir de la instantánea**

Para restaurar el volumen a su estado anterior, debe crear un nuevo PVC basado en los datos de la instantánea que tomó.  Para ello, guarde el siguiente manifiesto en un archivo llamado pvc-clone.yaml

[source]
----
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
 name: postgresql-volume-clone
spec:
 accessModes:
   - ReadWriteOnce
 storageClassName: trident-csi
 resources:
   requests:
     storage: 8Gi
 dataSource:
   name: postgresql-volume-snap-01
   kind: VolumeSnapshot
   apiGroup: snapshot.storage.k8s.io
----
Cree un clon del volumen creando una PVC usando la instantánea como fuente usando el manifiesto anterior.  Aplique el manifiesto y asegúrese de que se cree el clon.

image:redhat-openshift-container-rosa-024.png["clon de postgresql desde una instantánea"]

**b.  Eliminar la instalación original de postgresql**

image:redhat-openshift-container-rosa-025.png["eliminación de la aplicación postgresql"]

**do.  Cree una nueva aplicación postgresql usando el nuevo PVC clonado**

[source]
----
$ helm install postgresql bitnami/postgresql --set primary.persistence.enabled=true --set primary.persistence.existingClaim=postgresql-volume-clone -n postgresql
----
image:redhat-openshift-container-rosa-026.png["nueva instalación de postgresql"]

**d.  Verifique que el pod de aplicación esté en estado de ejecución**

image:redhat-openshift-container-rosa-027.png["nueva instalación de postgresql"]

**mi.  Verifique que el pod use el clon como su PVC**

image:redhat-openshift-container-rosa-028.png["descripción de la nueva instalación de postgresql"]

image:redhat-openshift-container-rosa-029.png["El nuevo PVC es el clon."]

f) Para validar que la base de datos se haya restaurado como se esperaba, regrese a la consola del contenedor y muestre las bases de datos existentes.

image:redhat-openshift-container-rosa-030.png["base de datos restaurada"]



== Vídeo de demostración

.Amazon FSx for NetApp ONTAP con Red Hat OpenShift Service en AWS mediante plano de control alojado
video::213061d2-53e6-4762-a68f-b21401519023[panopto,width=360]
Puede encontrar más vídeos sobre Red Hat OpenShift y las soluciones OpenShiftlink:../videos/openshift-videos.html["aquí"] .
