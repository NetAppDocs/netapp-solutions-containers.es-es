---
sidebar: sidebar 
permalink: tanzu/vtwn-trident-ontap-iscsi.html 
keywords: Trident, Trident, ONTAP, AFF, FAS, iSCSI, Tanzu, TKG, TKGS, TKGI 
summary: Para integrar el sistema de almacenamiento NetApp ONTAP con clústeres VMware Tanzu Kubernetes para volúmenes persistentes a través de iSCSI, el primer paso es preparar los nodos iniciando sesión en cada nodo y configurando las utilidades o paquetes iSCSI para montar volúmenes iSCSI. 
---
= Configuración de iSCSI de NetApp ONTAP
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Para integrar el sistema de almacenamiento NetApp ONTAP con los clústeres VMware Tanzu Kubernetes para volúmenes persistentes a través de iSCSI, el primer paso es preparar los nodos iniciando sesión en cada nodo y configurando las utilidades o paquetes iSCSI para montar volúmenes iSCSI.  Para ello, siga el procedimiento establecido en estelink:https://docs.netapp.com/us-en/trident/trident-use/worker-node-prep.html#iscsi-volumes["enlace"^] .


NOTE: NetApp no recomienda este procedimiento para implementaciones NAT de clústeres VMware Tanzu Kubernetes.


NOTE: TKGI utiliza máquinas virtuales Bosh como nodos para clústeres Tanzu Kubernetes que ejecutan imágenes de configuración inmutables, y cualquier cambio manual de paquetes iSCSI en máquinas virtuales Bosh no permanece persistente después de los reinicios.  Por lo tanto, NetApp recomienda utilizar volúmenes NFS para el almacenamiento persistente de los clústeres Tanzu Kubernetes implementados y operados por TKGI.

Una vez que los nodos del clúster estén preparados para los volúmenes iSCSI, debe crear un backend que habilite la comunicación con el sistema de almacenamiento.  Configuramos un backend básico en esta solución, pero, si buscas opciones más personalizadas, visita la documentaciónlink:https://docs.netapp.com/us-en/trident/trident-use/ontap-san.html["aquí"^] .



== Crear una SVM en ONTAP

Para crear una SVM en ONTAP, complete los siguientes pasos:

. Inicie sesión en ONTAP System Manager, navegue a Almacenamiento > Máquinas virtuales de almacenamiento y haga clic en Agregar.
. Ingrese un nombre para la SVM, habilite el protocolo iSCSI y luego proporcione detalles para los LIF de datos.
+
image:vtwn-025.png["LIF de datos SVM iSCSI"]

. Ingrese los detalles de la cuenta de administración de SVM y luego haga clic en Guardar.
+
image:vtwn-026.png["Administración de iSCSI SVM"]

. Para asignar los agregados a la SVM, navegue a Almacenamiento > Máquinas virtuales de almacenamiento, haga clic en los puntos suspensivos junto a la SVM recién creada y, luego, haga clic en Editar.  Marque la casilla de verificación Limitar la creación de volumen a niveles locales preferidos y adjúntele los agregados necesarios.
+
image:vtwn-027.png["Asignación agregada de SVM"]





== Crear backends y StorageClasses

. Para los sistemas NetApp ONTAP que prestan servicio a NFS, cree un archivo de configuración de backend en el jumphost con backendName, managementLIF, dataLIF, svm, nombre de usuario, contraseña y otros detalles.
+
[listing]
----
{
  "version": 1,
  "storageDriverName": "ontap-san",
  "backendName": "ontap-san+10.61.181.231",
  "managementLIF": "172.21.224.201",
  "dataLIF": "10.61.181.231",
  "svm": "trident_svm_iscsi",
  "username": "admin",
  "password": "password"
}
----
. Cree el backend Trident ejecutando el siguiente comando.
+
[listing]
----
[netapp-user@rhel7 trident-installer]$ ./tridentctl -n trident create backend -f backend-ontap-san.json
+------------------------+----------------+--------------------------------------+--------+---------+
|          NAME          | STORAGE DRIVER |                 UUID                 | STATE  | VOLUMES |
+------------------------+----------------+--------------------------------------+--------+---------+
| ontap-san+10.61.181.231 | ontap-san      | 6788533c-7fea-4a35-b797-fb9bb3322b91 | online |       0 |
+------------------------+----------------+--------------------------------------+--------+---------+
----
. Después de crear un backend, debes crear una clase de almacenamiento.  La siguiente definición de clase de almacenamiento de muestra resalta los campos obligatorios y básicos.  El parámetro `backendType` debe reflejar el controlador de almacenamiento del backend Trident recién creado.  Tenga en cuenta también el valor del campo de nombre, al que se debe hacer referencia en un paso posterior.
+
[listing]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: ontap-iscsi
provisioner: csi.trident.netapp.io
parameters:
  backendType: "ontap-san"
----
+

NOTE: Hay un campo opcional llamado `fsType` que se define en este archivo.  En los backends iSCSI, este valor se puede configurar para un tipo de sistema de archivos Linux específico (XFS, ext4, etc.) o se puede eliminar para permitir que los clústeres de Tanzu Kubernetes decidan qué sistema de archivos usar.

. Cree la clase de almacenamiento ejecutando el comando kubectl.
+
[listing]
----
[netapp-user@rhel7 trident-installer]$ kubectl create -f storage-class-iscsi.yaml
storageclass.storage.k8s.io/ontap-iscsi created
----
. Una vez creada la clase de almacenamiento, deberá crear la primera reclamación de volumen persistente (PVC).  A continuación se muestra un ejemplo de definición de PVC.  Asegúrese de que el `storageClassName` El campo coincide con el nombre de la clase de almacenamiento recién creada.  La definición de PVC se puede personalizar aún más según sea necesario en función de la carga de trabajo que se va a aprovisionar.
+
[listing]
----
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: basic
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
  storageClassName: ontap-iscsi
----
. Cree la PVC emitiendo el comando kubectl.  La creación puede tardar algún tiempo dependiendo del tamaño del volumen de respaldo que se esté creando, por lo que puedes observar el proceso a medida que se completa.
+
[listing]
----
[netapp-user@rhel7 trident-installer]$ kubectl create -f pvc-basic.yaml
persistentvolumeclaim/basic created

[netapp-user@rhel7 trident-installer]$ kubectl get pvc
NAME    STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
basic   Bound    pvc-7ceac1ba-0189-43c7-8f98-094719f7956c   1Gi        RWO            ontap-iscsi      3s
----

